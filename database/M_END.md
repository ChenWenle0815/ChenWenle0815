## M 端到底在玩什么？

### 背景
2022 年开始开始工作至今，分配到的工作，主要都集中在 P 端和 M 端，期间也穿插写过不多的 C 端需求，C 端的需求主要在做些什么，没玩明白，但是对于 M/P 端还是有一些心得体会的，记录于此，欢迎诸君批评指教。本文先讲 M 端。


### 思考🤔
#### 五个阶段
M，指 Management，是管理的意思，那么 M 端也就是指一些后台管理系统，说白了就是让运营来使用的一些具有增删改查功能的系统。在前端角度来看，就是表单（数据查询）+ 展示（数据展示）组合而成的界面。这是最基本的。

是的，这是第一阶段，熟练使用例如 Element-UI 这样的组件库，用好其中的 Form 组件，Input、Select ；Table 组件。做好其中的校验逻辑、表单字段之间的关联关系等。其背后所代表的数据结构也是简单的，例如收集个人信息的一个简单结构体：
```
interface IStudent {
  name: string; // 对应着一个 Input
  age: number;  // Input
  nation: string; // 对应着一个下拉框
}
```

那么第二阶段是什么呢？第二阶段可能让你去收集一个班的信息，然后结构体就变成这样了：

```
interface IClass {
  name:string;
  size:number;
  students: Array<IStudent>
}
```
数据结构仅仅增加了一层，变成数组，就已经开始优点麻烦了。这时候增加上更复杂的一些功能和校验逻辑就不那么简单了：增加和删除一个学生的信息，当我输入学生姓名的时候，调用接口回填学号，没有学号时，备注设置为必填等等，会是很复杂的产品逻辑。而 M 端的产品，仅说我合作过的，专业的实在太少，有的不画图、有的不写功能、有的设计的就是垃圾。你如果经验不够丰富，会因此被提很多 Bug。这才仅仅是第二阶段，但是熟悉就好，还不能算难。

第二阶段还常常伴随的一个烦人的点是什么？ 数据结构的转换。查询时，后端返回的数据结构，往往与我们页面中需要 v-for 或者 v-if 的结构不匹配；提交时，需要的入参又往往要重新塞成后端要的样子。面对复杂的数据结构，怎么才能把代码写清晰？我有两个好方法：
1. 使用 TS，TS 天生的类型强校验，和表单复杂的数据结构是绝配。使用 interface 能清晰看懂，利于维护。
2. 代码分层，对于这些转换函数放到单独的 service 层，写成纯函数，尽量不写在组件里。

第三阶段，就是配置下发的动态表单。
如果有大量的表单，重复的需求，而且还是第二阶段的复杂问题，那岂不是很痛苦。那么设计出一个通用逻辑，是必不可少的，由后端下发定义好的数据结构，前端解析渲染出页面，在某种程度上说着也也是一种 DSL。简单来说，把表单需要用到的这些属性放到配置了，然后根据约定好的 Code 条件展示。这里还不得不提，阿里的开源框架，Formily，当年我设计的一个动态表单在后面看来，与之还是有一些会心一笑的地方呢。

第四阶段，低代码。
从 2021 年开始火起来的 DSL，到今天也已经很成熟了，大多简单页面都可以使用拖拽的方式来搭建，样式、逻辑也可以在界面上进行修改。现在看来，2022 年结束，公司也基本实现了简单运营界面全面低代码化。

未来
未来一定是 AI 的，现在的大模型已经可以自动生成一写界面了，但难点感觉还是在逻辑，在与后端交互，这部分还是依赖于人。 或许应该把前后端交互逻辑定义好，然后训练一个针对于某种 DSL 的特有的算法，专门来写，也是一个思路吧。




